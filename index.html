<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <title>Assignment 4: Mapbox Strollytelling S3765046</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'>
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css' rel='stylesheet'>
  <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
  <script src="https://unpkg.com/scrollama"></script>
  <link rel="stylesheet" href="./Stylesheet.css">
</head>
<body>
  <div id="map"></div>
  <div id="menu">
    <input id="outdoors-v11" type="radio" name="rtoggle" value="outdoors"> <label for="outdoors-v11">outdoors</label> <input id="satellite-v9" type="radio" name="rtoggle" value="satellite"> <label for="satellite-v9">satellite</label>
  </div>
  <script>
  mapboxgl.accessToken = 'pk.eyJ1IjoiZ2xha3NoYXkyNDc1IiwiYSI6ImNrMGh1M3dubTA2ZngzY3Fxc3EzYWc1b3UifQ.1y6Hhr2H83VxQYHNgSCpxA';
  var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/streets-v11',
  zoom: 13,
  center: [144.74007, -36.81058]
  });

  var layerList = document.getElementById('menu');
  var inputs = layerList.getElementsByTagName('input');

  function switchLayer(layer) {
  var layerId = layer.target.id;
  map.setStyle('mapbox://styles/mapbox/' + layerId);

  }


  for (var i = 0; i < inputs.length; i++) {
  inputs[i].onclick = switchLayer;
  }

  </script> <!-- Header -->
  <div class="header">
    <h1><b>Explore Victoria</b></h1>
    <h2>Exploring the rich diversity and beauty of regional Victoria: Mapping tourist destinations in Victoria.</h2>
    <div class="arrow">
                <span></span>
                <span></span>
                <span></span>
  
</div>
  </div><!-- Navigation bar -->
  <div id="navbar">
    <a href="Interactivemap.html">☞ Check the webmap</a> <a href="Dashboard.html">☞ Check the Dashboard</a> <a href="Survey.html">☞ Check the Survey</a> <a href="About.html">☞ About</a> <img src="https://live.staticflickr.com/65535/50249909263_3502c6a51c_m.jpg" style="float:right; height:100px;" title="Website Logo" alt="explore Victria"><br>
    <!-- Trigger/Open The Modal -->
     <button id="myBtn1">About this Map</button> <!-- The Modal -->
    <div id="myModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <div class="modal-header">
          <span class="close">×</span>
          <h1><u>General Instructions</u></h1>
        </div>
        <div class="modal-body">
        <h5>☞ This is an interactive story map showing some of the tourist destinations in the state of Victoria, Australia. The map has some basic elements like:<br>
        <br>
        ➊ Change map style/layer.<br>
        <br>
        ➋ Full screen map mode<br>
        <br>
        ➌ Scroll Back to Top Button<br>
        <br>
        ➍ Fullscreen<br>
        <br>
        ➎ Geocoder<br>
        <br>
        ➏ Navigation<br>
        <br>
        ➐ Scale<br>
        <br>
        <br>
        <u>The Author with this map tries to be compliant with Web Content Accessibility Guidelines (WCAG).</u><br>
        <br>
        ☞ This map respects the principles of WCAG.<br>
        ☞ This map is operable by both a <u>mouse</u> and a <u>keyboard</u> .<br>
        ☞ This map features voice assisted naration for each presented chapter. .<br>
        ☞ This map uses color blind friendly palettes to make content more accessible. .<br>
        <br>
        ☞ HINT: Start scrolling down using the right side bar and notice the map change its position.<br>
        <br>
        ☞ NOTE: OPEN THIS MAP IN YOUR BROWSER'S FULL SCREEN MENU FOR BETTER VIEWING RESULTS.<br></h5>
        <p style="color:blue;"><u>The web map is not supported by Internet Explorer web browser</u></p><img src="https://live.staticflickr.com/65535/50249909263_3502c6a51c_m.jpg" title="Website Logo" alt="explore Victria"></div>
      </div>
    </div>
  </div>
  <div id="story"></div><!-- Top button-->
  <button onclick="topFunction()" id="myBtn" title="Go to top" class="to-top">Back to top</button> 
  <script src="./Victriadestinations.js"></script> 
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
<link
rel="stylesheet"
href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
type="text/css"
/>
<!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
  <script>




  // Get the modal
  var modal = document.getElementById("myModal");

  // Get the button that opens the modal
  var btn = document.getElementById("myBtn1");

  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];

  // When the user clicks the button, open the modal 
  btn.onclick = function() {
  modal.style.display = "block";
  }

  // When the user clicks on <span> (x), close the modal
  span.onclick = function() {
  modal.style.display = "none";
  }

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
  }
  var mybutton = document.getElementById("myBtn");

  // When the user scrolls down 20px from the top of the document, show the button
  window.onscroll = function() {scrollFunction()};

  function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
  }

  // When the user clicks on the button, scroll to the top of the document
  function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  }
    


  // Chapter configuration

  var layerTypes = {
    'fill': ['fill-opacity'],
    'line': ['line-opacity'],
    'circle': ['circle-opacity', 'circle-stroke-opacity'],
    'symbol': ['icon-opacity', 'text-opacity'],
    'raster': ['raster-opacity'],
    'fill-extrusion': ['fill-extrusion-opacity']
  }

  var alignments = {
    'left': 'lefty',
    'center': 'centered',
    'right': 'righty'
  }

  function getLayerPaintType(layer) {
    var layerType = map.getLayer(layer).type;
    return layerTypes[layerType];
  }

  function setLayerOpacity(layer) {
    var paintProps = getLayerPaintType(layer.layer);
    paintProps.forEach(function(prop) {
        map.setPaintProperty(layer.layer, prop, layer.opacity);
    });
  }

  var story = document.getElementById('story');
  var features = document.createElement('div');
  features.classList.add(alignments[config.alignment]);
  features.setAttribute('id', 'features');

  var header = document.createElement('div');

  if (config.title) {
    var titleText = document.createElement('h1');
    titleText.innerText = config.title;
    header.appendChild(titleText);
  }

  if (config.subtitle) {
    var subtitleText = document.createElement('h2');
    subtitleText.innerText = config.subtitle;
    header.appendChild(subtitleText);
  }

  if (config.byline) {
    var bylineText = document.createElement('p');
    bylineText.innerText = config.byline;
    header.appendChild(bylineText);
  }

  if (header.innerText.length > 0) {
    header.classList.add(config.theme);
    header.setAttribute('id', 'header');
    story.appendChild(header);
  }

  config.chapters.forEach((record, idx) => {
    var container = document.createElement('div');
    var chapter = document.createElement('div');
    
    if (record.title) {
        var title = document.createElement('h3');
        title.innerText = record.title;
        chapter.appendChild(title);
    }
    
    if (record.image) {
        var image = new Image();  
        image.src = record.image;  
        chapter.appendChild(image);
    }
    
    if (record.description) {
        var story = document.createElement('p');
        story.innerHTML = record.description;
        chapter.appendChild(story);
    }

    container.setAttribute('id', record.id);
    container.classList.add('step');
    if (idx === 0) {
        container.classList.add('active');
    }

    chapter.classList.add(config.theme);
    container.appendChild(chapter);
    features.appendChild(container);
  });

  story.appendChild(features);

  var footer = document.createElement('div');

  if (config.footer) {
    var footerText = document.createElement('p');
    footerText.innerHTML = config.footer;
    footer.appendChild(footerText);
  }

  if (footer.innerText.length > 0) {
    footer.classList.add(config.theme);
    footer.setAttribute('id', 'footer');
    story.appendChild(footer);
  }

  mapboxgl.accessToken = config.accessToken;

  const transformRequest = (url) => {
    const hasQuery = url.indexOf("?") !== -1;     
    const suffix = hasQuery ? "&pluginName=journalismScrollytelling" : "?pluginName=journalismScrollytelling";    
    return {
      url: url + suffix
    }     
  }

  var map = new mapboxgl.Map({
    container: 'map',
    style: config.style,
    center: config.chapters[0].location.center,
    zoom: config.chapters[0].location.zoom,
    bearing: config.chapters[0].location.bearing,
    pitch: config.chapters[0].location.pitch,
    scrollZoom: true,
    transformRequest: transformRequest
  });

  var marker = new mapboxgl.Marker();
  if (config.showMarkers) {
    marker.setLngLat(config.chapters[0].location.center).addTo(map);
  }

  // instantiate the scrollama
  var scroller = scrollama();

  map.on("load", function() {
    // setup the instance, pass callback functions
    scroller
    .setup({
        step: '.step',
        offset: 5,
        progress: true
    })
    .onStepEnter(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.add('active');
        map.flyTo(chapter.location);
        if (config.showMarkers) {
            marker.setLngLat(chapter.location.center);
        }
        if (chapter.onChapterEnter.length > 0) {
            chapter.onChapterEnter.forEach(setLayerOpacity);
        }
    })
    .onStepExit(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.remove('active');
        if (chapter.onChapterExit.length > 0) {
            chapter.onChapterExit.forEach(setLayerOpacity);
        }
    });
  });

  // setup resize event
  window.addEventListener('resize', scroller.resize);

  // Fullscreen
  map.addControl(new mapboxgl.FullscreenControl());

//Geocoder
map.addControl(
new MapboxGeocoder({
accessToken: mapboxgl.accessToken,
mapboxgl: mapboxgl
})
);

// Add zoom and rotation controls to the map.
map.addControl(new mapboxgl.NavigationControl());

//Scale

map.addControl(new mapboxgl.ScaleControl({'position': 'bottom-right'}));





  </script>
</body>
</html>
